---
title: "Data 606 Final Project: New York City Road Condition Complaints and Demographics"
author: "Armenoush Aslanian-Persico"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    code_folding: hide
    theme: spacelab
  
---

# Introduction


---

## Topic

What is your research question? Why do you care? Why should others care?

Explanation of 311

Explanation of Census

Null hypothesis

Alternate hypothesis

---

## Cases
What are the cases, and how many are there?

Cases by zip code, combined data for 
182 zip codes in NYC
325025 street condition complaints with reported zip code in date range 

---

## Data Collection
Describe the method of data collection.

---

## Study Type
What type of study is this (observational/experiment)?
Explain how you've arrived at your conclusion using information on the sampling and/or experimental design.

---

### Sources

***New York City 311 Data***

NYC Open Data

311 Service Requests from 2010 to Present

<a href="https://nycopendata.socrata.com/">NYC Open Data</a>


***US Income Data***

US Census

2010-2014 American Community Survey 5-Year Estimates

Selected economic characteristics

<a href="http://factfinder.census.gov/">US Census Factfinder Portal</a>

***US Population and Demographic Data***

US Census

2010-2014 American Community Survey 5-Year Estimates

ACS DEMOGRAPHIC AND HOUSING ESTIMATES

<a href="http://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?pid=ACS_14_5YR_DP05&src=pt/">US Census Factfinder Portal</a>

---

# Data 

---

## Libraries

The following libraries were required.

```{r libraries, eval=TRUE, warning=FALSE, message=FALSE}
library(devtools)
library(DT)
library(ggplot2)
library(jsonlite)
library(knitr)
library(plotly)
library(plyr)
library(psych)
library(dplyr)
library(RCurl)
library(reshape2)
library(rmarkdown)
library(shiny)
library(stringr)
library(tidyr)
```

```{r libraries1, eval=FALSE, warning=FALSE, message=FALSE}
library(XML)
library(scales)
library(RColorBrewer)
library(leaflet)
library(httr)

```

---

## Response 
What is the response variable, and what type is it (numerical/categorical)?

---

## Explanatory
What is the explanatory variable(s), and what type is it (numerical/categorival)?

---

## Relevant summary statistics

182 zip codes in NYC
96710 mean income by zip code for NYC
325025 street condition complaints with reported zip code in date range 

---

## Generalizability

Scope of inference
Identify the population of interest, and whether the findings from this analysis can be generalized to that population, or, if not, a subsection of that population. Explain why or why not. Also discuss any potential sources of bias that might prevent generalizability.

---

## Causality

Scope of inference
Can these data be used to establish causal links between the variables of interest? Explain why or why not.

---

# Transformation

---


## Street Conditions

The following is a list of options for street condition complaints when making a report to 311.

For this project, 7 of the 26 complaints were selected. The five asphalt-related complaints were combined into the asphalt complaint category. The remaining two were the two options for marking complaints: faded and missing.

```{r complaintlist, eval=TRUE, warning= FALSE, message=FALSE}

complaintlist<-getURL("https://raw.githubusercontent.com/spsstudent15/2016-01-606-Project/master/complainttypes.csv")

df2<- data.frame(read.csv(text=complaintlist))

datatable(df2, options = list( pageLength = 5, lengthMenu = c(5, 10, 40),   initComplete = JS(
    "function(settings, json) {",
    "$(this.api().table().header()).css({'background-color': '#01975b', 'color': '#fff'});",
    "}")), rownames=TRUE)
```


---

## 311 Raw Data

This project spans 311 complaints from January 1, 2013 through May 12, 2016.

311 receives millions of complaints each year across all city agencies: Health, Environmental Protection, Sanitation, Police, and others.

For this project, the data was filtered as follows:

1. Only Department of Transportation data. 

2. Only complaints which had a zip code as part of the complaint, to make data analysis possible.

3. Only complaints which were for a street condition.

4. Only the 5 primarily asphalt-related street conditions and 2 markings-related street conditions.

**Asphalt conditions**

- Pothole	
- Rough, Pitted or Cracked Roads	
- Hummock	
- Cave-in	
- Failed Street Repair	

**Marking conditions**

- Line/Marking - After Repaving
- Line/Marking - Faded

To further simplify, all asphalt conditions were combined into one roadway surface complaint group, named "asphalt."

Missing values were filled in as 0.

**Sample view of 311 data**

```{r sample311, eval=TRUE, warning= FALSE, message=FALSE}

sample311<-getURL("https://raw.githubusercontent.com/spsstudent15/2016-01-606-Project/master/sample311.csv")

df1<- data.frame(read.csv(text=sample311))

datatable(df1, options = list( pageLength = 5, lengthMenu = c(5, 10),  initComplete = JS(
    "function(settings, json) {",
    "$(this.api().table().header()).css({'background-color': '#00838f', 'color': '#fff'});", "}"), rownames=TRUE))
```


---

## Zip Code by Borough

A list of zip codes and their associated borough was extracted from the 311 data.
Created table of zip codes and associated borough

---

## Income by Zip Code

Income information by zip code was retrieved from the US Census. 

The data was transformed as follows, via the US Census portal and dataset processing.

- Downloaded New York State zip codes only.
- Selected columns using metadata.
- Converted zip column to display zip code only.
- Added "ZIP_" prefix to prevent forcing to numeric value.

The relevant attribute column names were as follows:

- HC01_VC90 - Estimate; INCOME AND BENEFITS (IN 2014 INFLATION-ADJUSTED DOLLARS) - With earnings - Mean earnings (dollars)

This attribute corresponded to mean income per zip code.

---

## Demographics by Zip Code

Population and demographic information by zip code were retrieved from the US Census and transformed as per the previous section.

The relevant attribute column names were as follows:

- HC01_VC03 - Estimate; SEX AND AGE - Total population
- HC03_VC49 - Percent; RACE - One race - White
- HC03_VC50 - Percent; RACE - One race - Black or African American

These attributes corresponded to total population per zip code, percent white per zip code, percent black per zip code.

---

## Combined Dataset

The datasets were merged and transformed to display the required data. The combined datasets were uploaded to GitHub for reproducibility.

The following is attribute information for the combined primary dataset.


**Attribute Names:**

```{r dictionary, eval=TRUE}
dict <- getURL("https://raw.githubusercontent.com/spsstudent15/2016-01-606-Project/master/sdatadictionary.csv")

dictionary<- data.frame(read.csv(text=dict))

datatable(dictionary, options = list( pageLength = 5, lengthMenu = c(5, 10),  initComplete = JS(
    "function(settings, json) {",
    "$(this.api().table().header()).css({'background-color': '#fff9c4', 'color': '#000000'});", "}"), rownames=TRUE))

```

```{r loaddata, eval=TRUE}
sumzipdata <- getURL("https://raw.githubusercontent.com/spsstudent15/2016-01-606-Project/master/zipdatacsv2.csv")

sdata<- data.frame(read.csv(text=sumzipdata))

monthdata<- getURL("https://raw.githubusercontent.com/spsstudent15/2016-01-606-Project/master/monthlycomplaints.csv")

mdata<- data.frame(read.csv(text=monthdata))

```

---

# Statistics



---

## Summary

The following is a summary of the primary dataset.

```{r sum1, eval=TRUE}
# Structure
# Summary
# Distribution of Road Condition Complaints Per Capita

str(sdata)
summary(sdata)

hist(sdata$pcomp, col="#fff9c4", breaks=10, main="Distribution of Road Condition Complaints Per Capita", xlab="Complaints Per Capita")
```

---

## Income

```{r income, eval=TRUE}
# Box Plot of Income and Population by Zip Code
# Distribution of Income
# Road Condition Complaints vs. Income
# Road Condition Complaints vs. Income, with xlim1
# Road Condition Complaints vs. Income, with xlim2

boxplot(sdata$income, sdata$pop, names=c("Income","Population"), col=c("#c5e1a5","#ffe0b2"), main="Box Plot of Income and Population by Zip Code")

hist(sdata$income, col="#c5e1a5", breaks=20, main="Distribution of Income", xlab="Income")

minc<- lm(pcomp ~ income, data = sdata)
plot(sdata$pcomp ~ sdata$income, col="#81d4fa", main="Road Condition Complaints vs. Income", xlab="Income", ylab="Complaints Per Capita")
abline(minc)

minc1<- lm(pcomp ~ income, data = sdata)
plot(sdata$pcomp ~ sdata$income, col="#1976d2", main="Road Condition Complaints vs. Income, $20,000-$200,000", xlab="Income", ylab="Complaints Per Capita", xlim=c(20000,200000))
abline(minc1)

minc2<- lm(pcomp ~ income, data = sdata)
plot(sdata$pcomp ~ sdata$income, col="#01579b", main="Road Condition Complaints vs. Income, $30,000-$100,000", xlab="Income", ylab="Complaints Per Capita", xlim=c(30000,100000), ylim=c(0,0.10))
abline(minc2)

```

---

## Race

```{r race, eval=TRUE}
# Correlation for Percent White
# Correlation for Percent Black
# Distribution of Percent Whites in Zip Code
# Distribution of Percent Blacks in Zip Code
# Road Condition Complaints vs. Percentage Whites
# Road Condition Complaints vs. Percentage Blacks
# Residuals for Percent White
# Residuals for Percent Black


wcor<-cor(sdata$pcomp, sdata$pwhite)
bcor<-cor(sdata$pcomp, sdata$pblack)

hist(sdata$pwhite, col="#ffcc80", breaks=20, main="White Population", xlab="Distribution of Percent Whites in Zip Code", ylim=c(0,70))

hist(sdata$pblack, col="#26a69a", breaks=20, main="Black Population", xlab="Distribution of Percent Blacks in Zip Code", ylim=c(0,70))

mwhite<- lm(pcomp ~ pwhite, data = sdata)
plot(sdata$pcomp ~ sdata$pwhite, col="#ffcc80", main="Road Condition Complaints vs. Percentage Whites", xlab="Percent White Population per Zip Code", ylab="Complaints Per Capita")
abline(mwhite)

mblack<- lm(pcomp ~ pblack, data = sdata)
plot(sdata$pcomp ~ sdata$pblack, col="#26a69a", main="Road Condition Complaints vs. Percentage Blacks", xlab="Percent Black Population per Zip Code", ylab="Complaints Per Capita")
abline(mblack)


# Residuals for Percent White

plot(mwhite$residuals ~ sdata$pcomp, main="Residuals for Percent White", col="#ffcc80", xlab="Per Capita Complaints", ylab="Residuals")
abline(mwhite)

hist(mwhite$residuals, main="Residuals for Percent White", ylim=c(0,80), xlab="Residuals" , col="#ffcc80")

qqnorm(mwhite$residuals, col="#ffcc80")
qqline(mwhite$residuals, col="#ffcc80")


# Residuals for Percent Black

plot(mblack$residuals ~ sdata$pcomp, main="Residuals for Percent Black", col="#26a69a", xlab="Per Capita Complaints", ylab="Residuals")
abline(mblack)

hist(mblack$residuals, main="Residuals for Percent Black", ylim=(c(0,80)), xlab="Residuals", col="#26a69a")

qqnorm(mblack$residuals, col="#26a69a")
qqline(mblack$residuals, col="#26a69a")

```

- The correlation for whites and per capita roadway complaints is `r round(wcor,2)`.

- The correlation for blacks and per capita roadway complaints is `r round(bcor,2)`.


---

## Borough

```{r boro, eval=TRUE}
# Box Plots by Borough

# Per Capita Complaints by Borough
# Per Capita Complaints by Borough, Asphalt Only
# Per Capita Complaints by Borough, Missing Markings Only
# Per Capita Complaints by Borough, Faded Markings Only


boxplot(
    sdata$pcomp[sdata$borough=="BRONX"],
    sdata$pcomp[sdata$borough=="BROOKLYN"],
    sdata$pcomp[sdata$borough=="MANHATTAN"],
    sdata$pcomp[sdata$borough=="QUEENS"],
    sdata$pcomp[sdata$borough=="STATEN ISLAND"],
    col=(c("#E8EAF6","#c5cae9","#9fa8da","#7986cb","#5c6bc0")),
    names=(c("BRONX","BKLYN","MANHATTAN","QUEENS","STATEN IS.")), 
    main="Per Capita Complaints by Borough", ylab="Per Capita Complaints", xlab="Borough")


boxplot(
    sdata$pcompa[sdata$borough=="BRONX"],
    sdata$pcompa[sdata$borough=="BROOKLYN"],
    sdata$pcompa[sdata$borough=="MANHATTAN"],
    sdata$pcompa[sdata$borough=="QUEENS"],
    sdata$pcompa[sdata$borough=="STATEN ISLAND"],
    col=(c("#E8EAF6","#c5cae9","#9fa8da","#7986cb","#5c6bc0")),
    names=(c("BRONX","BKLYN","MANHATTAN","QUEENS","STATEN IS.")), 
    main="Per Capita Complaints by Borough, Asphalt Only", ylab="Per Capita Asphalt Complaints", xlab="Borough")

boxplot(
    sdata$pcompm[sdata$borough=="BRONX"],
    sdata$pcompm[sdata$borough=="BROOKLYN"],
    sdata$pcompm[sdata$borough=="MANHATTAN"],
    sdata$pcompm[sdata$borough=="QUEENS"],
    sdata$pcompm[sdata$borough=="STATEN ISLAND"],
    col=(c("#E8EAF6","#c5cae9","#9fa8da","#7986cb","#5c6bc0")),
    names=(c("BRONX","BKLYN","MANHATTAN","QUEENS","STATEN IS.")), 
    main="Per Capita Complaints by Borough, Missing Markings Only", ylab="Per Capita Missing Markings Complaints", xlab="Borough")

boxplot(
    sdata$pcompf[sdata$borough=="BRONX"],
    sdata$pcompf[sdata$borough=="BROOKLYN"],
    sdata$pcompf[sdata$borough=="MANHATTAN"],
    sdata$pcompf[sdata$borough=="QUEENS"],
    sdata$pcompf[sdata$borough=="STATEN ISLAND"],
    col=(c("#E8EAF6","#c5cae9","#9fa8da","#7986cb","#5c6bc0")),
    names=(c("BRONX","BKLYN","MANHATTAN","QUEENS","STATEN IS.")), 
    main="Per Capita Complaints by Borough, Faded Markings Only", ylab="Per Capita Faded Markings Complaints", xlab="Borough", ylim=c(0,0.006))
```


Comparing the mean of the distributions by splitting the variable into the borough groups.

```{r boromeans, eval=TRUE}
# means by borough

by(sdata$pcomp, sdata$borough, mean)
by(sdata$pcomp, sdata$borough, summary)
```

---

## Time

```{r bymonth2, eval=TRUE}
ggplot(
  mdata, aes(x = yyyymm, y = tcomplaints, fill=tcomplaints)) + 
  geom_bar(stat="identity") +
  ggtitle("Complaints by Month")+ 
  theme(axis.text=element_text(angle=90))+
  labs(x="Month",y="Complaints")
```

---

## Outliers

High income

ZIP_10803 232513	BRONX actually Westchester county

ZIP_11109 168940	QUEENS Long Island City new skyscraper condos on the waterfront

Highest complaints per capita
ZIP_10004 Lower Manhattan, includes the NYC DOT headquarters

ZIP_11363 Little Neck, Queens

Note on missing/incorrect zip codes showing as 0 income or NA income

---

## Inference

**Satisfying conditions for inference**

Sample size n>30
Unimodal normal distribution
Random sample

Theoretical inference (if possible) - hypothesis test and confidence interval
Simulation based inference - hypothesis test and confidence interval
Brief description of methodology that reflects your conceptual understanding

---

### Hypothesis test

---

### Confidence interval


---

# Conclusion

---

## Summary


---

## Insights

Self-selection of 311 reporters
Why people may  not want to call 311
Some of these reports are not available on the mobile app and require the web interface or a phone call to report.

Median income would have been better than mean since high incomes in large cities skews the average higher. In reality, close to 50% of NYC is living below or near the poverty line, a very different story from a mean income of $90,000.

Missing and faded markings might mean the same thing to 311 callers. For operational purposes I was looking for accurate data since these are handled through different processes.

Problems with excluding blank zip codes - this might leave out disenfranchised neighborhoods.

---

## Future Research

